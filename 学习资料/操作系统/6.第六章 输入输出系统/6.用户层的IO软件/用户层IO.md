### 6.用户层的I/O软件

大部分I/O软件都在操作系统内部

用户层 : 与用户程序链接在一起的库函数、完全运行于内核之外的假脱机系统等

#### 1.系统调用与库函数

##### 1.系统调用

​		不允许用户态的进程直接调用系统态的OS过程.

​		OS在用户程序中引入一个中介过程——系统调用.

​		系统调用是应用程序取得OS所有服务的唯一途径.

##### 2.库函数

​		系统调用和库函数之间几乎是一一对应的.

​		操作系统在用户层提供了一些非常有用的程序. 假脱机系统、守护进程 . 运行在内核之外的程序,但输入/IO系统

#### 2.假脱机系统

多道程序技术 : 一台物理CPU-->多台逻辑CPU.. 允许多个用户共享一台主机.

假脱机技术 : 一台物理I/O设备-->多台逻辑I/O设备  允许多个用户共享一台物理I/O设备

##### 1.假脱机技术

​		为了缓和CPU的高速性与I/O设备低速性间的矛盾.

​		技术实现 : 利用主机的外围控制机,将低速I/O设备的数据传送到高速磁盘上.

​							处理机 --- 磁盘 --- I/O

​		多程程序中的一道 :             模拟脱机输入时外围控制机功能,把低速I/O设备上的数据传送到高速磁盘上.

​								 另一道程序 : 模拟脱机输出时外围控制机功能,把数据从磁盘传送到低速输出设备上.

​				从而实现以前的脱机输入、脱机输出的功能..

​				此时外围操作与CPU对数据处理同时进行...

​				这种联机情况下实现的同时外围操作的技术称为SPOOLing技术...假脱机技术

<img src="%E7%94%A8%E6%88%B7%E5%B1%82IO.assets/image-20201211193044161.png" alt="image-20201211193044161" style="float:left" />

##### 2.SPOOLing的组成

​		SPOOLing技术是对脱机输入/输出系统的模拟.

​		SPOOLing系统建立在通道技术和多道程序技术的基础上,以高速随机外存为后援存储器.

<img src="%E7%94%A8%E6%88%B7%E5%B1%82IO.assets/IMG_5175.jpg" alt="IMG_5175" style="zoom: 25%;float:left" />

SPOOLing系统主要由以下四部分组成 :

1. 输入和输出井
   1. 磁盘上的两个存储区域
   2. 输入井 模拟脱机输出时的磁盘,用于收容IO设备输入时的数据
   3. 输入输出井一般以文件的形式组织管理,这些文件称为井文件.
   4. 一个文件仅存放一个输出/输入数据.所有的输入/输出文件链接成一个输入/输出队列
2. 输入缓冲区和输出缓冲区
   1. 内存上的两个缓冲区
   2. 用于缓和CPU和磁盘之间速度不匹配的矛盾
   3. 输入缓冲区 暂存输入设备传送的数据,之后传递到输入井.
   4. 输出缓冲区 暂存输出井输出的数据, 之后再传送到输出设备.
3. 输入进程和输出进程
4. 井管理程序
   1. 用于控制作业与磁盘井之间信息的交换.
   2. 操作系统调用井管理程序

##### 3.SPOOLing系统的特点

1. 提高了I/O的速度
   1. 低速设备的I/O操作--->磁盘缓冲区中数据的存取
2. 将独占设备改造为共享设备
   1. 没有为任何进程分配设备
   2. 而是在磁盘缓冲区中为进程分配一个空闲盘块和建立一张I/O请求表
3. 实现了虚拟设备功能
   1. 一台物理独占设备, 多台逻辑独占设备

##### 4.假脱机打印机系统

​		假脱机打印系统主要由以下三部分 :

1. 磁盘缓冲区
   1. 在磁盘上开辟的一个存储空间
   2. 可在缓冲区设置几个盘块队列
2. 打印缓冲区
   1. 设置在内存中缓和PCU和磁盘之间速度的不匹配
3. 假脱机管理进程和假脱机打印进程
   1. 管理进程为每个要打印的用户数据建立一个假脱机文件
   2. 放入假脱机文件队列
   3. 打印进程依次对队列的文件进行打印
4. <img src="%E7%94%A8%E6%88%B7%E5%B1%82IO.assets/image-20201211233846938.png" alt="image-20201211233846938" style="zoom:100%;float:left" />



##### 5.守护进程

​		假脱机 - 假脱机管理进程 + 守护进程

​		守护进程 : 执行一部分原先由 假脱机管理进程实现的功能

​				为用户在磁盘缓冲区中申请一个盘块,将打印的数据送入其中,将盘块的首址返回给请求进程.

​				打印文件由请求进程自己生成,包含对打印的要求和指向装有打印输出数据盘块的指针等信息

​				然后将用户请求打印文件放入假脱机文件队列中

​		守护进程是允许使用打印机的唯一进程,.

​				文件放入假脱机文件队列

​				睡眠-->唤醒



